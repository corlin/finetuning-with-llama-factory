
# 基于GB/T 39786-2021及相关标准的密码应用QA对

## 密码算法实现细节类

### Q401: SM4分组密码算法的工作模式有哪些？在第四级信息系统中应优先选择哪种模式？

A401: SM4分组密码算法的工作模式包括ECB（电子密码本）、CBC（密码分组链接）、CFB（密码反馈）、OFB（输出反馈）、CTR（计数器）等。在第四级信息系统中，根据GB/T 43206-2023要求，应优先选择具有认证功能的加密模式（如GCM模式）或CBC模式配合消息认证码（如HMAC-SM3），以同时满足机密性和完整性要求。ECB模式因安全性不足，不建议在高级别系统中使用。

### Q402: SM2数字签名算法的完整流程包括哪些步骤？在第三级信息系统中如何验证签名有效性？

A402: SM2数字签名算法的完整流程包括：1）签名方生成随机数k；2）计算椭圆曲线点R=[k]G；3）计算r=e+x_R mod n（e为消息摘要，x_R为R的x坐标）；4）计算s=(1+d_A)^-1·(k-r·d_A) mod n（d_A为私钥）；5）输出签名(r,s)。在第三级信息系统中，验证签名有效性需：1）验证r,s在[1,n-1]范围内；2）计算e=H(M)；3）计算t=(r+s) mod n；4）计算椭圆曲线点P=[s]G+[t]P_A（P_A为公钥）；5）验证r=e+x_P mod n（x_P为P的x坐标）。同时需验证证书链有效性及证书用途是否符合GB/T 20518-2018要求。

### Q403: SM3杂凑算法的填充规则是什么？在密码应用中如何确保其安全性？

A403: SM3杂凑算法的填充规则为：1）在消息后添加一个"1"比特；2）添加k个"0"比特，使消息长度≡448 mod 512；3）添加64位原始消息长度（大端序）。在密码应用中确保其安全性的措施包括：1）使用符合GM/T 0004-2012标准的实现；2）避免在已知碰撞攻击场景下单独使用；3）在第四级系统中应与HMAC机制结合使用；4）确保随机数生成器满足GM/T 0005-2021要求；5）定期验证实现是否符合NIST SP 800-90A的健壮性要求。

### Q404: ZUC序列密码算法在4G/5G通信中的具体应用位置是什么？其初始化过程包含哪些关键步骤？

A404: ZUC序列密码算法在4G/5G通信中主要应用于：1）LTE/5G-NR的加密算法128-EEA3；2）完整性保护算法128-EIA3。其初始化过程关键步骤包括：1）装载128位密钥K和128位初始向量IV；2）执行31时钟周期的初始化模式；3）切换至工作模式生成密钥流。在第三级及以上信息系统中，需依据GM/T 0002-2012验证其实现是否正确处理了LFSR和F模块的交互，以及是否在每次会话前重新初始化。

### Q405: SM9标识密码算法与传统公钥密码的主要区别是什么？在政务云系统中如何部署？

A405: SM9标识密码算法与传统公钥密码的主要区别在于：1）SM9基于身份（如邮箱地址）而非随机数生成公钥；2）私钥由密钥生成中心（KGC）统一分发；3）无需数字证书管理公钥。在政务云系统中部署需：1）依据GM/T 0044-2016建设KGC系统；2）将KGC部署于符合GB/T 37092三级的安全区域；3）实施多级KGC架构（如省级-市级）；4）采用SM2保护KGC主密钥；5）在第三级系统中需实现KGC主密钥的"门限解密"机制（如3/5门限）。

## 行业应用场景类

### Q406: 电力行业SCADA系统在第三级密码应用中，对遥控指令的防重放攻击应如何实现？

A406: 电力行业SCADA系统在第三级密码应用中，对遥控指令的防重放攻击应：1）在遥控指令中嵌入时间戳（精度≤1秒）或序列号；2）使用SM4-CBC模式加密指令体；3）使用HMAC-SM3对指令体+时间戳/序列号进行完整性保护；4）在接收端验证时间戳/序列号在有效窗口内（如±5秒）；5）依据GB/T 36572-2018要求，序列号需存储在防篡改模块中。若为第四级系统，还需增加基于SM2的数字签名验证。

### Q407: 医疗物联网（IoMT）设备在第二级密码应用中，如何平衡安全性与资源受限问题？

A407: 医疗物联网（IoMT）设备在第二级密码应用中平衡安全性与资源受限的方法：1）选择轻量级密码算法（如SM4-128代替AES-256）；2）采用预共享密钥（PSK）模式替代证书体系；3）使用硬件安全模块（HSM）处理密码运算（如符合GM/T 0028的SE）；4）实施分层安全策略：核心节点用SM2认证，终端设备用HMAC-SM3；5）依据GB/T 37092一级要求，在设备固件中固化密钥更新机制。心跳包频率不低于10分钟/次，确保会话密钥定期刷新。

### Q408: 区块链电子存证系统在第四级密码应用中，如何实现数据原发性和接收性不可否认？

A408: 区块链电子存证系统在第四级密码应用中实现数据原发性和接收性不可否认的方法：1）数据原发方使用SM2私钥对文件哈希（SM3）签名；2）数据接收方使用自身SM2私钥对"数据哈希+原发签名"进行签名确认；3）将双签名+时间戳上链；4）依据GM/T 0032-2014，时间戳服务需使用符合GB/T 37092三级的TSS设备；5）链上存储签名验证公钥的证书指纹（SM3哈希），验证时需通过国密CA交叉认证。存证有效期应≥50年，需规划密钥归档方案。

### Q409: 车联网（V2X）通信在第三级密码应用中，如何解决低延迟与高安全的矛盾？

A409: 车联网（V2X）通信在第三级密码应用中解决低延迟与高安全矛盾的方法：1）采用预分配会话密钥（PSK）替代实时密钥协商；2）使用硬件加速的SM4-GCM模式（如符合GM/T 0045的芯片）；3）实施消息优先级策略：安全相关消息（如刹车指令）用HMAC-SM3，非关键消息用简化的完整性校验；4）依据GB/T 40429-2021，V2X设备需支持证书预装载（CRL更新周期≤24小时）；5）RSU（路侧单元）需部署密码运算加速卡，保证签名验证时间≤20ms。

### Q410: 工业控制系统（ICS）在第二级密码应用中，对Modbus TCP协议的安全增强应如何实施？

A410: 工业控制系统（ICS）在第二级密码应用中对Modbus TCP协议的安全增强实施方法：1）在Modbus TCP头部增加安全字段（4字节时间戳+4字节序列号）；2）使用SM4-CTR模式加密功能码和数据域；3）使用HMAC-SM3-96对完整APDU进行认证；4）依据GB/T 36324-2018要求，密钥更新周期≤30天；5）对工程师站和操作员站实施基于MAC地址的双因素认证。若系统无法改造，可在网关处部署符合GM/T 0023的IPSec VPN网关，采用ESP-AH组合保护。

## 测评技术实操类

### Q411: 使用Wireshark分析IPSec VPN通信时，如何验证其是否使用了国密算法？

A411: 使用Wireshark分析IPSec VPN通信验证国密算法的方法：1）捕获IKEv2协商包（UDP端口500/4500）；2）在"Internet Key Exchange"协议中查找"Transform"字段；3）验证Encryption Algorithm是否为"SM4-CBC"(OID=1.2.156.10197.1.104)；4）验证Integrity Algorithm是否为"HMAC-SM3"(OID=1.2.156.10197.1.401)；5）在ESP包中检查SPI值是否与协商一致。若为第四级系统，还需验证PFS（Perfect Forward Secrecy）是否采用SM2密钥交换。

### Q412: 对密码机进行性能测试时，应关注哪些关键指标？第三级系统的最低要求是什么？

A412: 密码机性能测试关键指标及第三级系统最低要求：1）SM4加密吞吐量：≥2Gbps（128位密钥，CBC模式）；2）SM2签名速度：≥500次/秒（256位密钥）；3）SM3哈希速度：≥1Gbps；4）密钥生成延迟：SM2密钥对≤100ms；5）最大并发连接数：≥1000；6）依据GB/T 43206-2023附录B，需测试在90%负载下连续运行72小时的稳定性。测试应使用符合GM/T 0008的随机数生成器构造测试数据。

### Q413: 如何使用OpenSC工具验证智能密码钥匙的COS是否符合国密要求？

A413: 使用OpenSC验证智能密码钥匙COS国密要求的方法：1）执行`opensc-tool -a`列出ATR，识别是否为国密产品（如"SM2"标识）；2）执行`pkcs15-tool --list-keys`验证密钥类型是否支持SM2；3）执行`pkcs11-tool --test --login`测试SM2签名/验签；4）验证关键指令APDU是否符合GM/T 0016：1）INS=0x2A（签名）；2）P1=0x9E（SM2）；3）LC=0x47（签名数据长度）；4）检查返回码SW=0x9000。第四级系统还需验证PIN码尝试次数是否符合GM/T 0027（错误10次锁定）。

### Q414: 在密码应用安全性评估中，如何检测密钥管理系统的"双人控制"机制是否有效？

A414: 检测密钥管理系统"双人控制"机制有效性的方法：1）审查密钥生成流程：确认需两人分别输入不同口令（如A输入生成口令，B输入授权口令）；2）测试密钥导出：尝试单人操作应失败，双人操作需记录操作日志（含操作员ID、时间、操作类型）；3）验证审计日志：检查密钥操作日志是否防篡改（如使用SM3-HMAC保护）；4）依据GB/T 43206-2023第7.2.2条，检查制度是否规定"任何密钥操作需两人同时在场"；5）抽查最近3个月的密钥操作记录，验证双人执行率是否达100%。

### Q415: 对数据库透明加密（TDE）进行测评时，如何验证其密钥层次结构是否符合第四级要求？

A415: 验证数据库TDE密钥层次结构符合第四级要求的方法：1）确认密钥层次：主密钥（MK）→列加密密钥（CEK）→数据加密密钥（DEK）；2）验证MK保护：应存储在符合GB/T 37092三级的HSM中，访问需多因素认证；3）测试CEK轮换：执行`ALTER COLUMN ... ENCRYPTION KEY ROTATION`，确认旧DEK仍可解密历史数据；4）审计检查：验证密钥操作日志包含操作员、时间、密钥版本、影响数据量；5）密钥备份测试：恢复MK后验证CEK/DEK是否可正常使用。依据GB/T 43206-2023第6.4.5条，需确认DEK更新周期≤90天。

## 合规性整改类

### Q416: 某金融系统测评发现"未实现重要可执行程序来源真实性验证"，应如何整改至第四级要求？

A416: 金融系统整改至第四级要求的措施：1）技术方案：在应用发布流程中增加代码签名环节，使用SM2私钥对可执行文件（.exe/.dll）进行签名；2）客户端部署：在终端安装国密签名验证驱动（如基于GM/T 0035的SDK）；3）验证流程：程序启动时自动验证签名有效性（包括证书链、用途、吊销状态）；4）密钥管理：签名私钥存储在符合GB/T 37092三级的HSM中，操作需双人控制；5）审计要求：记录程序启动日志（含文件路径、签名验证结果、时间戳）。整改后需通过GB/T 43206-2023第9.3.6条验证。

### Q417: 评估发现政务云平台"密钥管理员与密码操作员职责未分离"，违反了哪级要求？整改方案是什么？

A417: 违反第三级及以上要求（GB/T 39786-2021第8.6.2条）。整改方案：1）岗位拆分：设立"密钥管理员"（负责密钥生命周期管理）和"密码操作员"（负责日常设备操作）；2）权限分离：密钥管理员仅访问密钥管理系统（如KMS），操作员仅访问密码设备（如加密机）；3）审计机制：关键操作需双方共同审批（如密钥销毁需管理员提交申请，操作员执行）；4）系统控制：在密钥管理系统中设置权限矩阵，禁止同一账号同时拥有两类权限；5）应急处理：制定临时授权流程（需书面审批+双人监督）。整改后需通过GB/T 43206-2023第7.2.2.3条验证。

### Q418: 某企业系统"未定期进行密码应用安全性评估"，若系统为第三级，整改措施有哪些？

A418: 第三级系统整改措施：1）制度层面：修订《密码应用安全管理制度》，明确评估周期（≤12个月）和责任部门；2）人员安排：组建内部评估团队（需包含2名以上持证密评人员）或委托第三方机构；3）评估计划：制定《年度评估计划》，覆盖所有技术层面（物理/网络/设备/应用）和管理维度；4）工具准备：部署符合GM/T 0050的密码应用安全性评估工具；5）整改闭环：对评估发现的高风险问题制定整改方案（时限≤30天）。依据GB/T 43206-2023第7.3.5条，还需在运行过程中增加攻防对抗演习（频率≥6个月/次）。

### Q419: 评估发现"未对远程管理通道建立安全传输"，若系统为第四级，应如何整改？

A419: 第四级系统整改措施：1）技术方案：部署国密SSL VPN网关（符合GM/T 0024），要求：1）支持SM4-GCM加密；2）双向SM2证书认证；3）会话密钥更新周期≤30分钟；2）配置要求：禁用不安全的协议版本（如SSLv3/TLSv1.0）；3）访问控制：限制远程管理IP范围，启用双因素认证（如USB Key+动态口令）；4）审计增强：记录所有远程操作日志（含用户IP、操作命令、时间），日志防篡改（HMAC-SM3保护）；5）测试验证：使用Wireshark抓包验证所有远程管理流量均通过VPN隧道。整改后需通过GB/T 43206-2023第9.3.2条验证。

### Q420: 医疗系统"未建立关键岗位人员背景调查制度"，违反了哪级要求？整改方案是什么？

A420: 违反第四级要求（GB/T 39786-2021第9.6.2条）。整改方案：1）制度制定：发布《关键岗位人员背景调查管理办法》，明确：1）调查对象（密钥管理员/审计员/操作员）；2）调查内容（身份真实性、无犯罪记录、专业资质）；3）调查周期（入职前+每2年复查）；2）实施流程：1）委托第三方机构执行；2）审查材料包括身份证、学历证、无犯罪记录证明；3）结果需安全主管签字确认；3）档案管理：调查报告加密存储（SM4），保存期≥离职后3年；4）应急处置：发现隐瞒重大问题立即停职。整改后需通过GB/T 43206-2023第7.2.5.3条验证。

## 新兴技术融合类

### Q421: 量子计算对现有密码算法的威胁是什么？在第四级信息系统中应如何应对？

A421: 量子计算威胁及应对措施：1）威胁分析：Shor算法可在多项式时间内破解RSA/ECC/SM2，Grover算法将对称密钥安全强度减半（如SM4-128等效64位）；2）应对策略：1）部署抗量子密码（PQC）算法（如基于格的Kyber），但需等待国密标准发布；2）当前措施：1）增加SM4密钥长度至256位；2）采用SM2+SM3组合签名；3）缩短密钥更新周期（≤7天）；3）长期方案：规划"混合密钥体系"，同时使用传统算法和PQC算法。依据GB/T 43206-2023第9.4.4条，需在密码应用方案中明确量子安全升级路径。

### Q422: 区块链智能合约中调用密码运算的安全风险有哪些？如何通过国密技术降低风险？

A422: 智能合约密码运算风险及国密技术降低风险方法：1）主要风险：1）链上运算透明导致密钥暴露；2）Gas消耗过大导致交易失败；3）随机数生成不安全；2）国密技术方案：1）链下签名：使用SM2私钥在链外签名，链上验证；2）预编译合约：部署符合GM/T 0032的SM3/SM4预编译合约（地址固定为0x0n）；3）安全随机数：使用链下VRF（可验证随机函数）生成，链上验证；3）审计增强：合约调用密码操作需记录事件日志（含调用者地址、操作类型、时间戳）。第四级系统需验证合约是否通过国密区块链安全检测（如GM/T 0101）。

### Q423: 边缘计算场景下，如何实现轻量级但符合第三级要求的密码应用？

A423: 边缘计算轻量级第三级密码应用方案：1）硬件选型：采用符合GM/T 0002的轻量级加密芯片（如支持SM4的TEA）；2）算法优化：1）使用SM4-128代替SM4-256；2）HMAC-SM3-96代替完整HMAC；3）协议简化：1）预共享密钥（PSK）替代证书协商；2）使用DTLS 1.2+国密套件（ECDHE_SM4_SM3）；4）密钥管理：1）中心KGC生成设备密钥；2）密钥更新通过安全通道（如IPSec）推送；3）设备端密钥存储在SE（安全元件）中；5）审计机制：关键操作日志定期（≤4小时）同步至云端。需符合GB/T 37092二级安全要求。

### Q424: 人工智能模型训练过程中，如何使用密码技术保护训练数据隐私？

A424: 人工智能训练数据密码保护方案：1）数据加密：1）静态数据：使用SM4-XTS加密存储；2）传输数据：使用SSL VPN（国密套件）保护；2）隐私计算：1）联邦学习：使用SM2-Homomorphic加密（部分同态）实现梯度加密聚合；2）安全多方计算（MPC）：采用基于GM/T 0044的秘密共享方案；3）访问控制：1）基于属性的加密（ABE）：使用SM9实现细粒度访问控制；2）数据脱敏：用HMAC-SM3替换敏感字段；4）审计追踪：记录所有数据访问日志（含用户ID、操作类型、数据范围），日志上链存证。第四级系统需确保密钥分离（数据加密密钥与模型训练密钥独立）。

### Q425: 5G网络切片中，如何实现符合第四级要求的密码应用隔离？

A425: 5G网络切片第四级密码隔离方案：1）切片标识：每个切片分配唯一标识（ID），长度≥16字节；2）密钥隔离：1）每个切片独立密钥层次（KAM→KAS→KINT）；2）密钥派生使用SM3-KDF（GB/T 32918.5）；3）协议隔离：1）控制面：使用NAS-SMC（国密安全模式控制）协议；2）用户面：使用PDCP层加密（SM4-128），算法标识显式传递；4）设备隔离：核心网部署专用密码机（如切片A用加密机1，切片B用加密机2）；5）审计隔离：每个切片独立审计日志，存储在逻辑隔离的数据库中。需通过GB/T 43206-2023第9.2.4条验证切片间通信无密码资源混用。

## 标准条文解读类

### Q426: GB/T 39786-2021中"宜采用"与"应采用"在测评判定中有何区别？

A426: "宜采用"与"应采用"的测评区别：1）法律效力：1）"应采用"是强制性要求（如第四级"应采用双向身份鉴别"），不满足即判"不符合"；2）"宜采用"是推荐性要求（如第三级"宜采用密码技术保证视频监控音像记录数据的存储完整性"），不满足可判"部分符合"；2）风险等级：1）不满足"应采用"通常导致"高安全风险"；2）不满足"宜采用"需结合场景评估风险；3）整改要求：1）"应采用"项必须整改；2）"宜采用"项可基于成本效益分析决定是否整改。依据GB/T 43206-2023第10章，若"宜采用"项缺失导致系统性风险（如金融系统未实现不可否认性），仍可判"基本符合"。

### Q427: GB/T 43206-2023中"测评单元"的定义是什么？其与"控制项"的关系是什么？

A427: "测评单元"定义及与"控制项"关系：1）定义：测评单元是"一组相对独立和完整的测评内容，由测评指标、测评对象、测评实施和结果判定组成"（GB/T 43206-2023第3.12条）；2）组成要素：1）测评指标（如"应采用密码技术进行物理访问身份鉴别"）；2）测评对象（如电子门禁系统）；3）测评实施（如检查门禁系统是否使用国密算法）；4）结果判定（符合/部分符合/不符合）；3）与控制项关系：1）控制项是标准中具体要求（如GB/T 39786第6.1.1条）；2）一个控制项可能对应多个测评单元（如"重要数据机密性"控制项包含传输/存储两个测评单元）；3）测评单元是控制项的细化和可执行化。第三级系统测评单元数量应≥80个。

### Q428: GB/T 39786-2021中"多人共管机制"的具体要求是什么？在第四级系统中如何实现？

A428: "多人共管机制"要求及第四级实现：1）定义：指关键操作需由两人或多人共同完成，任何个人无法独立完成（GB/T 39786-2021第9.6.2条）；2）具体要求：1）适用岗位：密钥管理员、密码安全审计员、密码操作员；2）操作范围：密钥生成/销毁/备份/恢复；3）实施方式：1）物理方式：双人同时在场（如保险柜）；2）逻辑方式：分步操作（如A生成密钥分片，B合成）；4）第四级实现：1）密钥管理系统支持"门限解密"（如3/5门限）；2）操作需双人数字签名（SM2）；3）审计日志记录所有参与者ID。需通过GB/T 43206-2023第7.2.2.3条验证。

### Q429: GB/T 37092-2018中密码模块安全等级与信息系统安全等级的对应关系是什么？

A429: 密码模块安全等级与信息系统等级对应关系：1）GB/T 37092定义4个安全等级（一级至四级）；2）与GB/T 39786对应：1）二级信息系统→密码模块≥一级（如金融柜台终端）；2）三级信息系统→密码模块≥二级（如银行核心系统加密机）；3）四级信息系统→密码模块≥三级（如电力调度主站加密设备）；3）关键差异：1）一级模块：无物理安全要求，软件实现可接受；2）三级模块：要求防篡改外壳，运行环境监测；3）四级模块：要求环境失效保护，操作角色分离。测评时需依据GB/T 43206-2023第6.2.5条核查密码模块认证证书等级。

### Q430: GM/T 0054-2018《信息系统密码应用基本要求》与GB/T 39786-2021的主要区别是什么？

A430: 两标准主要区别：1）发布背景：1）GM/T 0054-2018是行业标准，侧重密码管理；2）GB/T 39786-2021是国家标准，融合等保2.0要求；2）结构差异：1）GB/T 39786按技术/管理维度划分；2）GM/T 0054按密码功能划分；3）内容更新：1）GB/T 39786增加"不可否认性"维度；2）GB/T 39786明确五级框架（第五级略）；3）测评要求：1）GB/T 39786配套GB/T 43206测评规范；2）GM/T 0054无配套测评标准。当前以GB/T 39786-2021为强制执行标准，GM/T 0054可作为行业补充。